{% extends "__base_core.html" %}
{% load static %}
{% block page_title %} {{ viewParams.MON_VO }} PanDA jobs{% endblock %}
{% block subtitle %}PanDA jobs
{#    {{ viewParams.selection|safe }}#}
{#{% if showwarn and njobs%}#}
{#    <span style="color:#FF8040;"><b>Warning: limit {{joblimit}} per job table</b></span>#}
{#{% endif %}#}
{% endblock %}
{#{% block subtitle_params %}{% endblock %}#}


{#{{ viewParams.header }}#}

{% block time_window %}
    Modification time window: <span class="time-window-range">{{ timerange.0 }}</span>
    - <span class="time-window-range">{{ timerange.1 }}</span> UTC
{% endblock %}

{% if requestParams.length > 1 %}
  {% block filter_cloud %}
    {% for param, value in requestParams.items %}
      <a class="tag-cloud-individual-tag" href="#">{{ param }} : {{ value }} <i class="fi fi-x-circle" aria-hidden="true"></i></a>
    {% endfor %}
    <a class="tag-cloud-individual-tag add" href="#">add <i class="fi fi-plus"></i></a>
  {% endblock %}
{% endif %}

{#<b>{{ njobs }} jobs in this selection</b>#}
{#{% if requestParams.transferringnotupdated %}<br><b>Jobs in transferring state for more than {{ requestParams.transferringnotupdated }} hours</b> {% endif %}#}
{#{% if requestParams.statenotupdated %}<br><b>Jobs in <span class="{{ requestParams.jobstatus }}">{{ requestParams.jobstatus }}</span> state for more than {{ requestParams.statenotupdated }} hours</b> {% endif %}#}
{#{% if requestParams.workinggroup %}<br><b>Working group: {{ requestParams.workinggroup }}</b> {% endif %}#}
{#{% if requestParams.jobtype %}<br><b>Job type: {{ requestParams.jobtype }}</b> {% endif %}#}
{#{% if requestParams.jobstatus %}<br><b>Job status: <span class={{requestParams.jobstatus}}>{{ requestParams.jobstatus }}</span></b> {% endif %}#}
{#{% if requestParams.cloud %}<br><b>Cloud: {{ requestParams.cloud }}</b> {% endif %}#}
{#{% if requestParams.computingsite %}<br><b>Site: <a href="{% url 'siteInfo' requestParams.computingsite %}">{{ requestParams.computingsite }}</a> <a href="{% url 'siteInfo' requestParams.computingsite %}">Show site information page</a></b> {% endif %}#}
{#{% if user %}<br><b>User: <a href="{% url 'userInfo' user %}?display_limit=100">{{ user }}</a> <a href="{% url 'userInfo' user %}?display_limit=100"> Show user page</a></b> {% endif %}#}
{#{% if requestParams.jeditaskid and requestParams.jeditaskid != 'None' %}<br><b>Task: <a href="{% url 'taskInfo' requestParams.jeditaskid  %}">{{ requestParams.jeditaskid }}      {{ taskname }}</a> </b> {% endif %}#}
{#{% if requestParams.taskid and requestParams.taskid != 'None' %}<br><b>Task: <a href="{% url 'taskInfo' requestParams.taskid  %}">{{ requestParams.taskid }}      {{ taskname }}</a></b> {% endif %}#}
{#{% if requestParams.jobsetid %}<br><b>Jobset ID: {{ requestParams.jobsetid }}</b> {% endif %}#}
{#{% if requestParams.parentid %}<br><b>Parent ID: {{ requestParams.parentid }}</b> {% endif %}#}
{##}
{#{% if requestParams.reqid %}<br><b>Request ID: {{ requestParams.reqid }}</b> {% endif %}#}
{#{% if requestParams.reqid_from %}<br><b>From request ID: {{ requestParams.reqid_from }}</b> {% endif %}#}
{#{% if requestParams.reqid_to %}<br><b>To request ID: {{ requestParams.reqid_to }}</b> {% endif %}#}
{##}
{#{% if requestParams.jobname %}<br><b>Job name: {{ requestParams.jobname }}</b> {% endif %}#}
{#{% if requestParams.priorityrange %}<br><b>Current priority range: {{ requestParams.priorityrange }}</b> {% endif %}#}
{#{% if requestParams.processingtype %}<br><b>Processing type: {{ requestParams.processingtype }}</b> {% endif %}#}
{#{% if requestParams.transformation %}<br><b>Transformation: {{ requestParams.transformation }}</b> {% endif %}#}
{#{% if requestParams.fileid and requestParams.jeditaskid and requestParams.datasetid %}#}
{#<br><b>File ID: <a href="{% url 'fileInfo' %}?jeditaskid={{ requestParams.jeditaskid }}&datasetid={{ requestParams.datasetid }}&fileid={{ requestParams.fileid }}">{{ requestParams.fileid }}</a></b>#}
{#<br><b>Dataset ID: <a href="{% url 'datasetInfo' %}?jeditaskid={{ requestParams.jeditaskid }}&datasetid={{ requestParams.datasetid }}">{{ requestParams.datasetid }}</a> </b>#}
{#{% endif %}#}
<p>

{% block body %}

{% if njobs > 0 %}

{#  time window charts #}
<script src="{% static 'upd/bower_components/moment/min/moment.min.js' %}"></script>
<script>
    let timestamps_hist = {{ timestamp_hist|safe }};
    let nentries = {{ njobs }};
</script>

{% if 'chartlib' in requestParams and requestParams.chartlib in 'allchartjs' %}

<canvas id="time-window-chart_chartjs" style="height: 300px; width: 100%;"></canvas>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.js"></script>
<script type="text/javascript">
    let chartjs_data = [];
    for (let timestamp in timestamps_hist) {
        chartjs_data.push({x: new Date(moment(timestamp, 'YYYY-MM-DD hh:mm:ss')), y:timestamps_hist[timestamp]});
    }
    var ctx = $('#time-window-chart_chartjs');
    let options = {
        scales: {
            xAxes: [{
                offset: true,
                type: 'time',
                time: {
                    displayFormats: {
                        minute: 'YYYY MMM D h:mm a'
                    }
                }
            }]
        }
    };
    var tw_chartjs = new Chart(ctx, {
        type: 'bar',
        data: {
            datasets: [{
                label: 'number of entries',
                backgroundColor: "#355681",
                data: chartjs_data
            }]
        },
        options: options
    });
</script>

{% endif %}
{% if 'chartlib' in requestParams and requestParams.chartlib in 'allc3js' %}


<!-- Load c3.css -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.7.8/c3.min.css" rel="stylesheet">

<!-- Load d3.js and c3.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.12.0/d3.min.js" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.7.8/c3.min.js"></script>


<div id="time-window-chart_c3js" style="height: 300px; width: 100%;"></div>

<script>
{#let timestamps_hist = {{ timestamp_hist|safe }};#}
let c3js_data = [['x', 'number of entries']];
for (let timestamp in timestamps_hist) {
    c3js_data.push([timestamp, timestamps_hist[timestamp]]);
}
var tw_c3js = c3.generate({
    bindto: '#time-window-chart_c3js',
    data: {
        x: 'x',
        xFormat: '%Y-%m-%d %H:%M:%S',
        rows: c3js_data,
        type: 'bar'
    },
    bar: {
        width: {
            ratio: 0.5
        }
    },
    axis: {
        x: {
            type: 'timeseries',
            tick: {
                format: '%Y-%m-%d %H:%M:%S'
            }
        }
    },
    color: {
        pattern: ['#355681']
    },
    subchart: {
        show: true
    }
});

d3.select('#time-window-chart_c3js').select("svg").append("text")
    .attr("x", 500 )
    .attr("y", 10)
    .style("text-anchor", "middle")
    .text("Total number of found jobs: " + nentries);

function update_timewindow_from_chart(tw_chart) {
    let selected_timewindow = tw_chart.zoom();
    let base_url = '{{ notime_url|safe }}';
    base_url += 'date_from=' + moment(selected_timewindow[0]).format('YYYY-MM-DDTHH:mm:ss');
    base_url += '&date_to=' + moment(selected_timewindow[1]).format('YYYY-MM-DDTHH:mm:ss');
    window.location.replace(base_url)
}

</script>

<a class="button primary" onclick="update_timewindow_from_chart(tw_c3js)">Apply selected time window</a>


{% endif %}



<!-- Attributes summary -->

<div class="card bp-container">
    <div class="card-divider">
        <span>Jobs attributes summary</span>
        <ul class="tabs" data-active-collapse="true" data-tabs id="collapsing-tabs">
            <li class="tabs-title align-middle is-active"><a href="#oas_panel_table" aria-selected="true">Table</a></li>
            <li class="tabs-title"><a href="#oas_panel_plots">Plots</a></li>
        </ul>
    </div>
    <div class="tabs-content" data-tabs-content="collapsing-tabs">
      <div class="tabs-panel" id="oas_panel_table">
        <div class="card-section">
            Here is table
        </div>
      </div>
      <div class="tabs-panel is-active" id="oas_panel_plots">
        <div class="card-section">
            Here is plots
        </div>
      </div>
    </div>
</div>

<!-- End of Attributes summary -->

<!-- Objects list -->

<div class="card bp-container">
    <div class="card-divider">
        List of jobs:
    </div>
    <div class="card-section">

    </div>
</div>

<!-- End of objects list -->




{#{% if ndrops > 0 %}#}
{#<table width=900><tr><td class='highlightcell'>#}
{#<b>{{ ndrops }} jobs were dropped from this listing because they were retried. Where there were retries, the latest retry job (only) is listed. </b>#}
{##}
{#<a style="cursor: pointer;" onclick="javascript:toggleDetailDisplay('retries');"><br>Click to show/hide dropped jobs</a>#}
{#<br><a href="{{xurl}}mode=nodrop">Switch to nodrop mode</a>#}
{#<div class="retries" style="display:none">#}
{#<font size=-1>#}
{#<br>Dropped (retry):<br>#}
{#{% for drop in droplist %}#}
{#<a href="{% url 'jobInfo' drop.pandaid %}">{{ drop.pandaid }}</a> (<a href="{% url 'jobInfo' drop.newpandaid %}">{{ drop.newpandaid }}</a>)#}
{#{% endfor %}#}
{#</font>#}
{#</div>#}
{#</td></tr></table>#}
{#<p>#}
{##}
{#{% endif %}#}


{#{% if jobList %}#}
{##}
{#<table>#}
{#<tr class='tablesection'><th colspan=20> Job attribute summary, sort by {% if requestParams.sortby == 'count' %} count, <a href="{{nosorturl}}">alpha</a> {% else %} <a href="{{nosorturl}}sortby=count">count</a>, alpha {% endif %} </th></tr>#}
{#{% for fdict in sumd %}#}
{#<tr><th> {{ fdict.field }} ({{ fdict.list|length }})</th>#}
{#    <td><div class="comment more">#}
{#        {% for item in fdict.list %}#}
{#            {% if fdict.field == 'jeditaskid' %} <a href="{% url 'taskInfo' item.kname %}"> {{ item.kname }} </a><a href="{{xurl}}{{fdict.field}}={{item.kname}}" >({{ item.kvalue }})</a>#}
{#            {% elif fdict.field  == 'jobsetid'%} <a href="{% url 'jobList' %}?jobsetid={{ item.kname }}"> {{ item.kname }}</a> <a href="{{xurl}}{{fdict.field}}={{item.kname}}" >({{ item.kvalue }})</a>#}
{#            {% elif fdict.field  == 'harvesterinstance' %} {{ item.kname }} <a href="{{xurl}}{{fdict.field}}={{item.kname}}" >({{ item.kvalue }})</a>#}
{#            {% elif fdict.field  == 'durationmin' %} {% if item.kvalue > 0 %} {{ item.kname }} <a href="{{nodurminurl}}{{fdict.field}}={{item.kname}}" >({{ item.kvalue }})</a> {% endif %}#}
{#            {% else %}#}
{#                {% if fdict.field == 'jobstatus' %} <span class='{{item.kname}} item'> {% else %} <span class="item"> {% endif %}  {{ item.kname }} </span>#}
{#                {% if fdict.field == 'eventservicestatus' %} ({{ item.kvalue }}) {% else %}#}
{#                    <a {% if item.kname == 'closed:toreassign' %} href="{{xurl}}{{fdict.field}}=closed&jobsubstatus=toreassign"{% else %}#}
{#                                                                  href="{{xurl}}{{fdict.field}}={{item.kname}}" {% endif %}> ({{ item.kvalue }}) </a>#}
{#                {% endif %}#}
{#            {% endif %}#}
{#        {% endfor %}#}
{#        </div>#}
{#    </td>#}
{#</tr>#}
{#{% endfor %}#}
{#</table>#}

{#{% if errsByCount %}#}
{#<a name="summary"></a>#}
{#<table>#}
{#<tr class='tablesection'><th colspan=20> Overall error summary </th></tr>#}
{#<tr>#}
{#    <th>Category:code</th>#}
{#    <th>Attempt list</th>#}
{#    <th>Nerrors</th>#}
{#    <th>Sample error description</th>#}
{#</tr>#}
{#{% for errval in errsByCount %}#}
{#<tr>#}
{#    <th> <a href="{{xurl}}jobstatus=failed&{{errval.codename}}={{errval.codeval}}&display_limit=100"> {{ errval.error }} </a> </th>#}
{#    <td> <a href="{{xurl}}jobstatus=failed&{{errval.codename}}={{errval.codeval}}&display_limit=100"> jobs </a> </th>#}
{#    <td> {{ errval.count }} </td>#}
{#    <td> <div class="comment more">{{ errval.diag }}<br/>{% if errval.count > 1%} <a href="{% url 'summaryErrorsList'%}?codename={{errval.codename}}&codeval={{errval.codeval}}&tk={{ errval.tk }}" target="_blank"> more information here </a> {% endif %}</div>#}
{##}
{#    </td>#}
{#</tr>#}
{#{% endfor %}#}
{#</table>#}
{#{% endif %}#}


{##}
{#<div class="table-scroll">#}
{#<table>#}
{#<tr class='tablesection'><th colspan=20>#}
{#<a name="joblist"></a> Job list.#}
{#{% if display_limit  and display_limit < njobs %}#}
{#<font size=-1> Only the most recent {{ display_limit }} jobs are shown. Remove the limit and sort by#}
{#{% if sortby == "PandaID" %}#}
{#<b>PandaID</b>,#}
{#{% else %}#}
{#<a href="{{nosorturl}}sortby=PandaID">PandaID</a>, #}
{#{% endif %}#}
{#{% else %}#}
{#Sort by #}
{#{% if sortby == "PandaID" %}#}
{#<b>PandaID</b>,#}
{#{% else %}#}
{#<a href="{{nosorturl}}sortby=PandaID">PandaID</a>, #}
{#{% endif %}#}
{#{% endif %}#}
{##}
{##}
{#{% if sortby == "statetime" %}#}
{#time since last state change, <a href="{{nosorturl}}sortby=time-ascending">ascending mod time</a>, <a href="{{nosorturl}}sortby=time-descending">descending mod time</a>, <a href="{{nosorturl}}sortby=priority">priority</a>, <a href="{{nosorturl}}sortby=attemptnr">attemptnr</a>, <a href="{{nosorturl}}sortby=duration-ascending">ascending duration</a>, <a href="{{nosorturl}}sortby=duration-descending">descending duration</a>#}
{#{% elif sortby == "time-ascending" %}#}
{#<a href="{{nosorturl}}sortby=statetime">time since last state change</a>, <b>ascending mod time</b>, <a href="{{nosorturl}}sortby=time-descending">descending mod time</a>, <a href="{{nosorturl}}sortby=priority">priority</a>, <a href="{{nosorturl}}sortby=attemptnr">attemptnr</a>, <a href="{{nosorturl}}sortby=duration-ascending">ascending duration</a>, <a href="{{nosorturl}}sortby=duration-descending">descending duration</a>#}
{#{% elif sortby == "time-descending" %}#}
{#<a href="{{nosorturl}}sortby=statetime">time since last state change</a>, <a href="{{nosorturl}}sortby=time-ascending">ascending mod time</a>, <b>descending mod time</b>, <a href="{{nosorturl}}sortby=priority">priority</a>, <a href="{{nosorturl}}sortby=attemptnr">attemptnr</a>, <a href="{{nosorturl}}sortby=duration-ascending">ascending duration</a>, <a href="{{nosorturl}}sortby=duration-descending">descending duration</a>#}
{#{% elif sortby == "priority" %}#}
{#<a href="{{nosorturl}}sortby=statetime">time since last state change</a>, <a href="{{nosorturl}}sortby=time-ascending">ascending mod time</a>, <a href="{{nosorturl}}sortby=time-descending">descending mod time</a>, <b>priority</b>, <a href="{{nosorturl}}sortby=attemptnr">attemptnr</a>, <a href="{{nosorturl}}sortby=duration-ascending">ascending duration</a>, <a href="{{nosorturl}}sortby=duration-descending">descending duration</a>#}
{#{% elif sortby == "attemptnr" %}#}
{#<a href="{{nosorturl}}sortby=statetime">time since last state change</a>, <a href="{{nosorturl}}sortby=time-ascending">ascending mod time</a>, <a href="{{nosorturl}}sortby=time-descending">descending mod time</a>, <a href="{{nosorturl}}sortby=priority">priority</a>, <b>attemptnr</b>, <a href="{{nosorturl}}sortby=duration-ascending">ascending duration</a>, <a href="{{nosorturl}}sortby=duration-descending">descending duration</a>#}
{#{% elif sortby == "duration-ascending" %}#}
{#<a href="{{nosorturl}}sortby=statetime">time since last state change</a>, <a href="{{nosorturl}}sortby=time-ascending">ascending mod time</a>, <a href="{{nosorturl}}sortby=time-descending">descending mod time</a>, <a href="{{nosorturl}}sortby=priority">priority</a>, <a href="{{nosorturl}}sortby=attemptnr">attemptnr</a>, <a href="{{nosorturl}}sortby=duration-descending">descending duration</a>#}
{#{% elif sortby == "duration-descending" %}#}
{#<a href="{{nosorturl}}sortby=statetime">time since last state change</a>, <a href="{{nosorturl}}sortby=time-ascending">ascending mod time</a>, <a href="{{nosorturl}}sortby=time-descending">descending mod time</a>, <a href="{{nosorturl}}sortby=priority">priority</a>, <a href="{{nosorturl}}sortby=attemptnr">attemptnr</a>, <a href="{{nosorturl}}sortby=duration-ascending">ascending duration</a>#}
{#{% else %}#}
{#<a href="{{nosorturl}}sortby=statetime">time since last state change</a>, <a href="{{nosorturl}}sortby=time-ascending">ascending mod time</a>, <a href="{{nosorturl}}sortby=time-descending">descending mod time</a>, <a href="{{nosorturl}}sortby=priority">priority</a>, <a href="{{nosorturl}}sortby=attemptnr">attemptnr</a>, <a href="{{nosorturl}}sortby=duration-ascending">ascending duration</a>, <a href="{{nosorturl}}sortby=duration-descending">descending duration</a>#}
{#{% endif %}#}
{#</font>#}
{#</th></tr>#}
{#<tr class='tablesection'>#}
{#	<th>PanDA ID<br>Attempt# of maxAttempts#{% if requestParams.fileid %}<br><span style="color: gray">FileAttempt# of maxFileAttempt</span>{% endif %}</th>#}
{#	<th>Owner {% if viewParams.MON_VO != 'ATLAS' %} / VO{% endif %}<br>Group  </th>#}
{#	<th>Request<br>Task ID</th>#}
{#	<th>Transformation</th>#}
{#	<th>Status</th>#}
{#	<th>Created</th>#}
{#	<th>Time to start<br>d:h:m:s</th>#}
{#	<th>Duration<br>d:h:m:s</th>#}
{#	<th>Mod</th>#}
{#	<th>{% if viewParams.MON_VO == 'ATLAS' %}Cloud {% endif%}Site</th>#}
{#	<th>Priority</th>#}
{#    <th>N input events (N input files)</th>#}
{#    {% if requestParams.jeditaskid  %}#}
{#        <th>Maximum <br>PSS</th>#}
{#    {% endif %}#}
{#	<th>Job info</th>#}
{#</tr>#}
{#    {% for job in jobList %}#}
{#	<tr {% if job.jobstatus == 'failed'%} class="failedjob" {% endif %}>#}
{#		<td rowspan=3><a href="{% url 'jobInfo' %}?pandaid={{ job.pandaid }}">{{ job.pandaid }}</a><br>Attempt {{ job.attemptnr }} of {{ job.maxattempt }}#}
{#			{% if requestParams.fileid %}<br><span style="color: gray">FileAttempt {% if job.fileattemptnr or job.filemaxattempts %}{{ job.fileattemptnr }} of {{ job.filemaxattempts }}{% endif %}</span>{% endif %}#}
{#            <br>#}
{#		    {% if job.consumer %}#}
{#		     Consumer: <a href="{% url 'jobInfo' %}?pandaid={{ job.consumer }}">{{ job.consumer }}</a>#}
{#		    {% endif %}#}
{#            {% if request.user.is_tester %}#}
{#            {% if job.pandaid in clist %}#}
{#                <br>#}
{#                <a id="comparisonbutton{{ job.pandaid }}" onclick="toggleComparisonList('comparisonbutton{{ job.pandaid }}', '{{ job.pandaid }}')" class="removefromcomparisonbuttoncompact">Remove from comparison</a>#}
{#            {% else %}#}
{#                <br>#}
{#                <a id="comparisonbutton{{ job.pandaid }}" onclick="toggleComparisonList('comparisonbutton{{ job.pandaid }}', '{{ job.pandaid }}')" class="addtocomparisonbuttoncompact">Add to comparison</a>#}
{#            {% endif %}#}
{#            {% endif %}#}
{#        </td>#}
{#		<td><a href="{% url 'userInfo' job.produsername|safe %}?display_limit=100">{{ job.produsername }}</a>{% if job.workinggroup %}<br><a href="{{xurl}}workinggroup={{ job.workinggroup }}">{{ job.workinggroup }}</a>{% endif %}{% if viewParams.MON_VO != 'ATLAS' %}{% if job.vo %} / {{ job.vo }}{% endif %} {% endif %}#}
{#		</td>#}
{#		<td> {% if job.reqid %} <a href="{% url 'jobList' %}?reqid={{ job.reqid }}&display_limit=300">{{ job.reqid }}</a> <br> {% endif %}#}
{#		{% if job.jeditaskid  and job.jeditaskid != 'None' %}<a href="{{xurl}}jeditaskid={{job.jeditaskid}}">{{ job.jeditaskid }}</a> {% elif job.taskid and job.taskid != 'None' %} <a href="{% url 'jobList' %}?taskid={{job.taskid}}{% if job.taskid < 1000000 %}&produsername={{job.produsername}}{% endif %}&display_limit=100">{{ job.taskid }}</a> {% endif %}</td>#}
{#		<td><font size=-1><a href="{{xurl}}transformation={{job.transformation}}">{{ job.transformation }}</a></font></td>#}
{##}
{#		<td class='{{job.jobstatus}}_fill'>{{ job.jobstatus }}</td>#}
{#		<td><font size=-1>{{ job.creationtime }}</font></td>#}
{#		<td><font size=-1>{{ job.waittime }}</font></td>#}
{#		<td><font size=-1>{{ job.duration }}</font></td>#}
{#		<td><font size=-1>{{ job.modificationtime }}</font></td>#}
{#		<td><font size=-1>{% if viewParams.MON_VO == 'ATLAS' %}<a href="{{xurl}}cloud={{job.cloud}}">{{job.cloud}}</a> {% endif %}<a href="{% url 'siteInfo' job.computingsite %}">{{ job.computingsite }}</a> <span class='{{job.computingsitestatus}}'> {{job.computingsitestatus}}</span> {{job.computingsitecomment}} </font></td>#}
{#		<td>{{ job.currentpriority }}</td>#}
{#        <td>{{ job.nevents }} ({{ job.ninputs }})</td>#}
{#        {% if requestParams.jeditaskid  %}#}
{#        <td><font size=-1>{% if job.maxpss and job.maxpss != 'None' and job.maxpss != -1 %}{{ job.maxpss }}{% endif %}</font></td>#}
{#         {% endif %}#}
{#		<td width=250>{% if job.jobinfo != '' %}<font size=-1>{{job.jobinfo|safe}}</font><br>{% endif %}#}
{#		{% if job.errorinfo != '' %}<font size=-1 class='alarm'>{{job.errorinfo|safe}}</font>{% endif %}#}
{#		</td>#}
{#	<tr {% if job.jobstatus == 'failed'%} class="failedjob" {% endif %}><td colspan=12> <font size=-1>Job name: <a href="{% url 'jobList' %}?jobname={{ job.jobname }}&taskid={{ job.taskid }}{% if job.jeditaskid > 0 %}&jeditaskid={{ job.jeditaskid }}{% endif %}&mode=nodrop&sortby=attemptnr">{{ job.jobname }}</a></font>  #{{ job.attemptnr }}#}
{#    </td></tr>#}
{#	<tr {% if job.jobstatus == 'failed'%} class="failedjob" {% endif %}><td colspan="20" class='highlightcell'> Datasets: {% if job.proddblock %} <b> In:</b> <a href="{% url 'datasetInfo' %}?datasetname={{ job.proddblock }}"> {{ job.proddblock }} </a> || <a href="https://rucio-ui.cern.ch/did?scope={{ job.inputfileproject }}&name={{ job.proddblock }}" target="_blank"> Rucio link</a> {% endif %} {% if job.destinationdblock %} {% if job.proddblock %}<br> {% endif %} <b> Out:</b> <a href="{% url 'datasetInfo' %}?datasetname={{ job.destinationdblock }}"> {{ job.destinationdblock }} </a> {% endif %} </td></tr>#}
{##}
{#    {% endfor %}#}
{#</table>#}
{#</div>#}

{% else %}

<p>
No jobs matched the query. You can increase the time depth with a days=N parameter on the URL, but use judiciously, this is hard on the database. If you know the jobsetid or taskid/jeditaskid of the jobs you're interested in, you can add these to the URL, and the search will not be time limited (because these IDs give the DB enough indexing info that it isn't stressful on the DB to exclude the time constraint) and it will be fast also.
</p>

{% endif %}

{% endblock %}


{#{% block helptext %}#}
{#{% include "jobListHelp.html" with helptitle="Job list help" %}#}
{#{% include "jobInfoHelp.html" with helptitle="Job information" show="all" %}#}
{#{% endblock %}#}

