{% extends "_base_core.html" %}
{% load humanize %}
{% load static %}

{% block page_title %}Harvester worker {{ workerid }}{% endblock %}
{% block subtitle %}Harvester Worker {{ workerid }} details {{ viewParams.selection|safe }} {% endblock %}
{% block js_head_page_library %}
 <script type="text/javascript" src="{% static "/js/jquery.shorten.1.0.js" %}"></script>
{% endblock %}

{% block body %}
{% if workerinfo %}
<table class="bp-table secondary">
<thead>
  <tr><th colspan=24>Harvester worker parameters</th></tr>
</thead>
<tbody>
  {% for name,value in workerinfo.items %}
    {% if name == 'status' or name == 'nativestatus' %}
      <tr>
        <td>{{ name }}</td>
        <td>{% if value %}<span class='{{ value }}'>{{ value }}</span>{% else %}-{% endif %}</td>
      </tr>
    {% elif name == 'corrJobs'  %}
      <tr>
        <td>correspondent jobs</td>
        <td>
          {% if value %}
            <div class="comment more">{% for pandaid in value %}<span class="item"><a href="{% url 'jobInfo' pandaid %}">{{ pandaid }}</a></span>{% endfor %}</div>
          {% else %}
            -
          {% endif %}
        </td>
      </tr>
    {% elif name == 'jobsStatuses'%}
      <tr>
        <td>jobstatus summary </td>
        <td>
        {% if value %}
          <div class="comment more">
            {% for jobstatus, jobstatuscount in value.items %}
              <span class="item"><span class='{{ jobstatus }}'>{{ jobstatus }}</span> <a href="{% url 'jobList' %}?{% if harvesterid %}harvesterinstance={{ harvesterid }}{% endif %}{% if workerid %}&workerid={{ workerid }}{% endif %}&jobstatus={{ jobstatus }}"> ({{ jobstatuscount }})</a></span>
            {% endfor %}
          </div>
        {% else %}
          -
        {% endif %}
      </td>
      </tr>
    {% elif name == 'jobsSubStatuses'%}
      <tr>
        <td>jobsubstatus summary</td>
        <td>
        {% if value %}
          <div class="comment more">
            {% for jobsubstatus, jobsubtatuscount in value.items %}
               {{ jobsubstatus }} ({{ jobsubtatuscount }})
            {% endfor %}
          </div>
        {% else %}
          -
        {% endif %}
        </td>
      </tr>
    {% elif name == 'njobs'%}
      <tr>
        <td>{{ name }}</td>
        <td>{% if value and value > 0 %}<a href="{% url 'jobList' %}?{% if harvesterid %}harvesterinstance={{ harvesterid }}{% endif %}{% if workerid %}&workerid={{ workerid }}{% endif %}">{{ value }}</a>{% else %}{{ value }}{% endif %}</td>
      </tr>
    {% else %}
      <tr>
        <td>{{ name }}</td>
        <td>{% if 'http' in value or 'https' in value and value %} <a href="{{ value }}" target="_blank">{{ value }}</a>{% elif not value or value == '' %}-{% else %} {{ value }} {% endif %}</td>
      </tr>
    {% endif %}
  {% endfor %}
</tbody>
</table>
{% else %}
  <div class="callout alert"><h5>No worker found for specified parameters.</h5></div>
{% endif %}
{% endblock %}

{% block js_body_page %}
<script nonce={{request.csp_nonce}}>
$(document).ready(function() {
  $(".comment").shorten();
});
</script>
{% endblock %}